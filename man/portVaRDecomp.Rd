% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/portVaRDecomp.R
\name{portVaRDecomp}
\alias{portVaRDecomp}
\alias{portVaRDecomp.ffm}
\alias{portVaRDecomp.tsfm}
\title{Decompose portfolio VaR into individual factor contributions}
\usage{
portVaRDecomp(object, ...)

\method{portVaRDecomp}{tsfm}(object, weights = NULL, p = 0.95,
  type = c("np", "normal"), use = "pairwise.complete.obs", ...)

\method{portVaRDecomp}{ffm}(object, weights = NULL, p = 0.95,
  type = c("np", "normal"), ...)
}
\arguments{
\item{object}{fit object of class \code{tsfm}, or \code{ffm}.}

\item{...}{other optional arguments passed to \code{\link[stats]{quantile}} and 
optional arguments passed to \code{\link[stats]{cov}}}

\item{weights}{a vector of weights of the assets in the portfolio. Default is NULL, 
in which case an equal weights will be used.}

\item{p}{confidence level for calculation. Default is 0.95.}

\item{type}{one of "np" (non-parametric) or "normal" for calculating VaR. 
Default is "np".}

\item{use}{an optional character string giving a method for computing factor
covariances in the presence of missing values. This must be (an 
abbreviation of) one of the strings "everything", "all.obs", 
"complete.obs", "na.or.complete", or "pairwise.complete.obs". Default is 
"pairwise.complete.obs".}
}
\value{
A list containing 
\item{VaR.fm}{length-1 vector of factor model VaRs of portfolio returns.}
\item{n.exceed}{length-1 vector of number of observations beyond VaR.}
\item{idx.exceed}{list of numeric vector of index values of exceedances.}
\item{mVaR}{length-(N+K) vector of marginal contributions to VaR.}
\item{cVaR}{length-(N+K) vector of component contributions to VaR.}
\item{pcVaR}{length-(N+K) vector of percentage component contributions to VaR.}
Where, K is the number of factors and N is the number of assets.
}
\description{
Compute the factor contributions to Value-at-Risk (VaR) of 
portfolio return based on Euler's theorem, given the fitted factor model. 
The partial derivative of VaR w.r.t. factor beta is computed as the expected 
factor return given fund return is equal to its VaR and approximated by a
kernel estimator. Option to choose between non-parametric and Normal.
}
\details{
The factor model for an portfolio's return at time \code{t} has the 
form \cr \cr \code{R(t) = beta'f(t) + e(t) = beta.star'f.star(t)} \cr \cr 
where, \code{beta.star=(beta,sig.e)} and \code{f.star(t)=[f(t)',z(t)]'}. By 
Euler's theorem, the VaR of the asset's return is given by: 
\cr \cr \code{VaR.fm = sum(cVaR_k) = sum(beta.star_k*mVaR_k)} \cr \cr 
where, summation is across the \code{K} factors and the residual, 
\code{cVaR} and \code{mVaR} are the component and marginal 
contributions to \code{VaR} respectively. The marginal contribution to VaR 
is defined as the expectation of \code{F.star}, conditional on the loss 
being equal to \code{VaR.fm}. This is approximated as described in 
Epperlein & Smillie (2006); a triangular smoothing kernel is used here.
}
\examples{
# Time Series Factor Model
require(factorAnalytics)
data(managers)
fit.macro <- fitTsfm(asset.names=colnames(managers[,(1:6)]),
                     factor.names=colnames(managers[,(7:9)]),
                     rf.name="US.3m.TR", data=managers)
decomp <- portVaRDecomp(fit.macro)
# get the factor contributions of risk
decomp$cVaR
# random weights
wts = runif(6)
wts = wts/sum(wts)
portVaRDecomp(fit.macro, wts) 

# Fundamental Factor Model
data("stocks145scores6")
dat = stocks145scores6
dat$DATE = as.yearmon(dat$DATE)
dat = dat[dat$DATE >=as.yearmon("2008-01-01") & dat$DATE <= as.yearmon("2012-12-31"),]

#Load long-only GMV weights for the return data
data("wtsStocks145GmvLo")
wtsStocks145GmvLo = round(wtsStocks145GmvLo,5)  
                                                     
#fit a fundamental factor model
fit.cross <- fitFfm(data = dat, 
              exposure.vars = c("SECTOR","ROE","BP","PM12M1M","SIZE","ANNVOL1M","EP"),
              date.var = "DATE", ret.var = "RETURN", asset.var = "TICKER", 
              fit.method="WLS", z.score = TRUE)
decomp = portVaRDecomp(fit.cross) 
# get the factor contributions of risk 
decomp$cVaR
portVaRDecomp(fit.cross, weights = wtsStocks145GmvLo)               
 
}
\author{
Douglas Martin, Lingjie Yi
}

